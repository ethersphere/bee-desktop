<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; img-src 'self' data:;"> -->
    <meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; script-src 'self'" />
    <title>Screenshot Preview</title>

    <link rel="stylesheet" href="./preview.css">
</head>

<body>
    <main>
        <img id="screenshotImage" />
    </main>

    <div id="selectionBox" class="selection-box"></div>
    <script>
        const ONLINE_COLOR = " #19c10a";
        const OFFLINE_COLOR = " #FF3A52";


        document.addEventListener("DOMContentLoaded", () => {
            const screenshotImg = document.getElementById("screenshotImage");

            window.electron.onImageDataURL((imgDataURL) => {
                screenshotImg.src = imgDataURL;

                displayActionButtonsUI();
            });

        });


        /**
         *
         * @param {*} opts
         * @returns {HTMLElement}
         */
        function createElement(opts) {
            const elem = document.createElement(opts.tagName);

            if (opts.type) elem.type = opts.type;
            if (opts.id) elem.id = opts.id;
            if (opts.textContent) elem.textContent = opts.textContent;

            opts.classes?.forEach((clsName) => elem.classList.add(clsName));

            Object.entries(opts.attributes || {}).forEach(([k, v]) => {
                elem.setAttribute(k, v);
            });

            return elem;
        }

        function displayActionButtonsUI() {

            const footer = createElement({
                tagName: "footer",
                id: "btnContainer",
                classes: ["btn-container"],
            });

            const cropBtn = createElement({
                tagName: "button",
                id: "cropBtn",
                textContent: "Crop Image",
            });
            cropBtn.onclick = () => {
                const screenshotImg = document.getElementById("screenshotImage");
                window.electron.openCropWindow(screenshotImg.src);
            };

            const saveToDiskBtn = createElement({
                tagName: "button",
                id: "saveToDiskBtn",
                textContent: "Save Image",
            });
            saveToDiskBtn.onclick = () => {
                const screenshotImg = document.getElementById("screenshotImage");
                window.electron.writeImageToDisk(screenshotImg.src);
            };

            [cropBtn, saveToDiskBtn].forEach((elem) => {
                footer.insertAdjacentElement("beforeend", elem);
            });

            document.querySelector("main").insertAdjacentElement("afterend", footer);
        }

    </script>
</body>

</html>